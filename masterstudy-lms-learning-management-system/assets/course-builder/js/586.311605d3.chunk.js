"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[586],{61278:(e,r,i)=>{i.d(r,{h:()=>o});var n,l=i(65043);const t=["title","titleId"];function s(){return s=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s.apply(null,arguments)}function a(e,r){let{title:i,titleId:a}=e,o=function(e,r){if(null==e)return{};var i,n,l=function(e,r){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;i[n]=e[n]}return i}(e,r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(n=0;n<t.length;n++)i=t[n],r.indexOf(i)>=0||{}.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}(e,t);return l.createElement("svg",s({width:10,height:8,viewBox:"0 0 10 8",fill:"white",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":a},o),i?l.createElement("title",{id:a},i):null,n||(n=l.createElement("path",{id:"check",d:"M0 3.65909L1.33333 2.29545L4 5.02273L8.66667 0.25L10 1.61364L4 7.75L0 3.65909Z"})))}const o=l.forwardRef(a);i.p},71624:(e,r,i)=>{i.d(r,{h:()=>o});var n,l=i(65043);const t=["title","titleId"];function s(){return s=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s.apply(null,arguments)}function a(e,r){let{title:i,titleId:a}=e,o=function(e,r){if(null==e)return{};var i,n,l=function(e,r){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;i[n]=e[n]}return i}(e,r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(n=0;n<t.length;n++)i=t[n],r.indexOf(i)>=0||{}.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}(e,t);return l.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":a},o),i?l.createElement("title",{id:a},i):null,n||(n=l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C3.58469 0 0 3.58469 0 8C0 12.4153 3.58469 16 8 16C12.4153 16 16 12.4153 16 8C16 3.58469 12.4153 0 8 0ZM9.46875 8.42044C9.46875 7.60928 8.81119 6.95175 8.00006 6.95175C8.00003 6.95175 8.00003 6.95175 8 6.95175C7.61047 6.95175 7.23688 7.10647 6.96144 7.38194C6.686 7.65737 6.53125 8.03094 6.53125 8.4205C6.53125 9.30969 6.53125 10.6581 6.53125 11.5473C6.53125 11.9369 6.686 12.3105 6.96144 12.5859C7.23688 12.8613 7.61047 13.0161 8 13.0161C8.00003 13.0161 8.00003 13.0161 8.00006 13.0161C8.81119 13.0161 9.46875 12.3585 9.46875 11.5474V8.42044ZM8 2.98391C7.18937 2.98391 6.53125 3.64203 6.53125 4.45266C6.53125 5.26328 7.18937 5.92141 8 5.92141C8.81063 5.92141 9.46875 5.26328 9.46875 4.45266C9.46875 3.64203 8.81063 2.98391 8 2.98391Z"})))}const o=l.forwardRef(a);i.p},11837:(e,r,i)=>{function n(e,r,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"order";const l=e[r],t=[...e];return t.splice(r,1),t.splice(i,0,l),t.forEach(((e,r)=>{e[n]=r+1})),t}i.d(r,{Q:()=>n})},76586:(e,r,i)=>{i.r(r),i.d(r,{AdditionalBlock:()=>Z,CreateMembershipPlanPageContext:()=>P,CreateMembershipPlanPageProvider:()=>S,CreatePage:()=>le,InputSkeleton:()=>W,ListPage:()=>Se,LoadingWrapper:()=>R,MembershipPlanForm:()=>ie,MembershipPlanSummary:()=>re,PlanFeaturesBlock:()=>K,PlanInfoBlock:()=>T,PricingBlock:()=>A,TypeItemsSelect:()=>M,default:()=>Ee,getRenewalPeriod:()=>he,getType:()=>me,useCreateMembershipPlanPageContext:()=>C,useDeleteMembershipPlan:()=>je,useReorderMembershipPlans:()=>we,useUpdateMembershipPlanStatus:()=>ge});var n=i(3898),l=i(61667),t=i(21989),s=i(99887),a=i(89379),o=i(18403),c=i(65043),d=i(24858),p=i(82907),u=i(79478),x=i(31001),_=i(23086);const h=()=>{const e=new Date;return{name:"",description:"",type:"full_site",items:[],price:0,_sale_price_enabled:!1,_billing_cycle_type:"until_cancelled",sale_price:0,sale_price_from:e.getTime(),sale_price_from_time:(0,_.GP)(e,"HH:mm"),sale_price_to:e.getTime(),sale_price_to_time:(0,_.GP)(e,"HH:mm"),recurring_value:1,recurring_interval:"month",billing_cycles:null,plan_features:[],_enrollment_fee_enabled:!1,enrollment_fee:0,_trial_period_enabled:!1,trial_period:0,is_featured:!1,featured_text:"",is_certified:!0,_is_not_certified:!1,is_enabled:!0,_sale_price_schedule_enabled:!1,plan_order:0}},m=(e,r)=>e&&r?(0,_.GP)(new Date(e),"yyyy-MM-dd")+" ".concat(r,":00"):null,b=e=>{var r,i,n,l;let t=null;switch(e.type){case"course":t=null!==(r=null===(i=e._selected_courses)||void 0===i?void 0:i.map((r=>({object_id:r,object_type:e.type}))))&&void 0!==r?r:null;break;case"category":t=null!==(n=null===(l=e._selected_categories)||void 0===l?void 0:l.map((r=>({object_id:r,object_type:e.type}))))&&void 0!==n?n:null}return{name:e.name,description:e.description,enrollment_fee:e._enrollment_fee_enabled?e.enrollment_fee:null,featured_text:e.featured_text,is_featured:e.is_featured,is_certified:!e._is_not_certified,is_enabled:e.is_enabled,items:t,plan_features:e.plan_features,plan_order:e.plan_order,price:e.price,recurring_interval:e.recurring_interval,billing_cycles:"limited"===e._billing_cycle_type?e.billing_cycles:null,recurring_value:e.recurring_value,sale_price:e._sale_price_enabled?e.sale_price:null,sale_price_from:e._sale_price_schedule_enabled?m(e.sale_price_from,e.sale_price_from_time):null,sale_price_to:e._sale_price_schedule_enabled?m(e.sale_price_to,e.sale_price_to_time):null,trial_period:e._trial_period_enabled?e.trial_period:null,type:e.type}},f=e=>{const r=e?parseFloat(e):null;return Number.isNaN(r)?null:r},g=e=>{const r=e?parseInt(e):null;return Number.isNaN(r)?null:r};var j=i(51585);const w=e=>{const r=(0,j.gf)();return(0,p.useQuery)(["membership-plan",e],(async()=>(e=>{var r,i,n,l,t,s;const a=e.sale_price_from?new Date(e.sale_price_from):new Date,o=e.sale_price_to?new Date(e.sale_price_to):new Date,c=f(e.enrollment_fee),d=null!==(r=f(e.price))&&void 0!==r?r:0,p=f(e.sale_price),u=g(e.plan_order),x=g(e.trial_period),h=g(e.billing_cycles),m=g(e.recurring_value),b=[],j=[];if(e.items)for(const r of e.items)switch(r.object_type){case"course":b.push(r.object_id);continue;case"category":j.push(parseInt(r.object_id.toString()));continue}return{name:e.name,description:null!==(i=e.description)&&void 0!==i?i:null,_enrollment_fee_enabled:!!c,enrollment_fee:c,_sale_price_enabled:!!p,_billing_cycle_type:h?"limited":"until_cancelled",_sale_price_schedule_enabled:!!e.sale_price_from,_trial_period_enabled:!!x,featured_text:null!==(n=e.featured_text)&&void 0!==n?n:null,_is_not_certified:!parseInt(e.is_certified||"0"),is_certified:Boolean(parseInt(e.is_certified||"0")),is_enabled:!!e.is_enabled,is_featured:Boolean(parseInt(e.is_featured||"0")),items:null!==(l=e.items)&&void 0!==l?l:[],_selected_categories:j,_selected_courses:b,plan_features:null!==(t=e.plan_features)&&void 0!==t?t:[],plan_order:u,price:d,recurring_interval:null!==(s=e.recurring_interval)&&void 0!==s?s:null,billing_cycles:h,recurring_value:m,sale_price:p,sale_price_from:a.getTime(),sale_price_from_time:(0,_.GP)(a,"HH:mm"),sale_price_to:o.getTime(),sale_price_to_time:(0,_.GP)(o,"HH:mm"),trial_period:x,type:e.type}})((await r.membershipPlans.getMembershipPlan(e)).plan)),{enabled:!!e,staleTime:1/0})};var v=i(73467);var y=i(70579);const P=(0,c.createContext)(null),S=e=>{let{children:r,editId:i,inDrawer:n,defaultValues:t,isDrawerOpen:s,afterUpdate:_}=e;const[m,f]=(0,c.useState)(null!==i&&void 0!==i?i:null),g=(()=>{const{__:__}=(0,l.WD)(),e=__("This field is required"),r=__("Minimal value is 1");return v.Ik().shape({type:v.Yj().required(e),_selected_categories:v.YO().nullable().when("type",{is:e=>"category"===e,then:r=>r.required(e).min(1,__("Select at least 1 item")),otherwise:e=>e.notRequired()}),name:v.Yj().required(e),description:v.Yj().nullable(),recurring_value:v.ai().nullable().min(1,r).required(e),recurring_interval:v.Yj().nullable(),_billing_cycle_type:v.Yj().oneOf(["limited","until_cancelled"]),billing_cycles:v.ai().nullable().when("_billing_cycle_type",{is:e=>"limited"===e,then:i=>i.required(e).min(1,r),otherwise:e=>e.notRequired()}),price:v.ai().nullable().required(e).min(0,r),_sale_price_enabled:v.lc(),sale_price:v.ai().nullable().when("_sale_price_enabled",{is:e=>e,then:i=>i.required(e).min(1,r),otherwise:e=>e.notRequired()}),sale_price_from:v.ai().nullable(),sale_price_from_time:v.Yj().nullable(),sale_price_to:v.ai().nullable(),sale_price_to_time:v.Yj().nullable(),plan_features:v.YO().nullable(),enrollment_fee:v.ai().nullable(),trial_period:v.ai().nullable().when("_trial_period_enabled",{is:e=>e,then:i=>i.required(e).min(1,r),otherwise:e=>e.notRequired()}),is_featured:v.lc().nullable(),featured_text:v.Yj().nullable(),is_certified:v.lc().nullable(),is_enabled:v.lc().nullable()})})(),{__:__}=(0,l.WD)(),S=(0,p.useQueryClient)(),{showErrorToast:C}=(0,u.Ax)(),E=(0,d.mN)({defaultValues:(0,a.A)((0,a.A)({},h()),t),resolver:(0,o.t)(g)}),k=E.formState.isDirty,{mutate:D,isLoading:z}=(e=>{let{onError:r,onSuccess:i}=e;const n=(0,j.gf)();return(0,p.useMutation)((e=>n.membershipPlans.createMembershipPlan(b(e))),{onError:e=>{r(e)},onSuccess:e=>{i(e)}})})({onError:e=>{C(e)},onSuccess:e=>{f(e.plan_id),E.reset(E.getValues()),(0,x.L)({plan_id:e.plan_id.toString()},!1),S.invalidateQueries({queryKey:["membership-plans"]}),null===_||void 0===_||_(E.getValues().name,"create")}}),{mutate:L,isLoading:I}=(e=>{let{onError:r,onSuccess:i}=e;const n=(0,j.gf)();return(0,p.useMutation)((e=>{let[r,i]=e;return n.membershipPlans.updateMembershipPlan(r,b(i))}),{onError:e=>{r(e)},onSuccess:()=>{i()}})})({onError:e=>{C(e)},onSuccess:()=>{E.reset(E.getValues()),S.invalidateQueries({queryKey:["membership-plans"]}),S.invalidateQueries({queryKey:["membership-plan",m]}),null===_||void 0===_||_(E.getValues().name,"update")}}),{data:W,isLoading:R}=w(m);(0,c.useEffect)((()=>{W&&!k&&E.reset(W)}),[W,R,m]),(0,c.useEffect)((()=>{s&&!i&&E.reset((0,a.A)((0,a.A)({},h()),t)),f(i||null)}),[s,i]);return(0,y.jsx)(P.Provider,{value:{formProps:E,onCreate:()=>{m?E.handleSubmit((e=>L([m,e])))():E.handleSubmit((e=>D(e)))()},isLoading:R,isCreating:z||I,isEdit:!!m,editId:m,inDrawer:n},children:r})},C=()=>{const e=(0,c.useContext)(P);if(!e)throw new Error("useCreateMembershipPlanPageContext must be used within an CreateMembershipPlanPageProvider");return e};let E=function(e){return e.LIST="list",e.CREATE="create",e}({});var k=i(31590),D=i(54765),z=i(34688);const L=e=>{let{title:r,children:i,flexProps:n}=e;const{inDrawer:l}=C();return(0,y.jsxs)(t.s,(0,a.A)((0,a.A)({direction:"column",p:l?"0px":"40px",bg:"white",borderRadius:"10px",boxShadow:l?"":"0 1px 3px 0 rgba(0, 0, 0, 0.07)",gap:"20px"},n),{},{children:[(0,y.jsx)(z.E,{color:"dark",fontSize:"18px",fontWeight:"semibold",children:r}),i]}))};var I=i(19316);const W=e=>{let{titleWidth:r}=e;return(0,y.jsxs)(t.s,{direction:"column",gap:"3px",flex:"1",children:[r&&(0,y.jsx)(I.z,{w:r,h:"18px"}),(0,y.jsx)(I.z,{w:"100%",h:"40px"})]})},R=e=>{let{isLoading:r,skeleton:i,children:n}=e;return r?(0,y.jsx)(y.Fragment,{children:i}):(0,y.jsx)(y.Fragment,{children:n})},M=()=>{var e;const{__:__}=(0,l.WD)(),r=(0,d.xW)(),i=(0,c.useRef)(((null===(e=window.react_membership_plans)||void 0===e?void 0:e.categories)||[]).map((e=>(0,a.A)((0,a.A)({},e),{},{id:e.term_id}))));return"category"===r.watch("type")?(0,y.jsx)(D.BT,{label:__("Select Categories"),name:"_selected_categories",variant:"membership-plan",categories:i.current}):null},T=()=>{const{isLoading:e,inDrawer:r}=C(),{__:__}=(0,l.WD)(),i=(()=>{const{__:__}=(0,l.WD)();return[{label:__("Sitewide"),id:"full_site"},{label:__("Category-based"),id:"category"}]})();return(0,y.jsx)(L,{title:__("General Info"),children:(0,y.jsx)(R,{isLoading:e,skeleton:(0,y.jsxs)(t.s,{direction:"column",gap:"20px",children:[(0,y.jsx)(W,{titleWidth:"80px"}),(0,y.jsx)(W,{titleWidth:"130px"}),!r&&(0,y.jsx)(W,{titleWidth:"110px"})]}),children:(0,y.jsxs)(t.s,{direction:"column",gap:"20px",children:[(0,y.jsx)(D.A_,{name:"name",label:__("Title"),placeholder:__("Enter Plan Title")}),!r&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(D.A_,{name:"description",label:__("Short Description"),placeholder:__("Briefly describe this membership plan")}),(0,y.jsx)(D.zM,{name:"type",label:__("Membership Access Type"),options:i}),(0,y.jsx)(M,{})]})]})})})},O=e=>{let{name:r,children:i,title:n,inline:l=!0}=e;const s=(0,d.xW)().watch(r);return(0,y.jsxs)(t.s,{w:"100%",border:"1px solid",align:"center",p:l?"10px 20px":"20px",borderColor:s?"primary":"border",bg:s?"primary10":"transparent",flexDirection:l?"row":"column",borderRadius:"8px",sx:{".chakra-form__error-message":{position:"relative"}},children:[(0,y.jsx)(D.by,{name:r,label:n}),i]})},A=e=>{var r;let{currencyInfo:i,recurring_intervals:n}=e;const{__:__}=(0,l.WD)(),s=(e=>{var r;const i=null!==e&&void 0!==e?e:(null===(r=window.react_membership_plans)||void 0===r?void 0:r.recurring_intervals)||[],{__:__}=(0,l.WD)(),n=e=>{switch(e){case"day":return __("Day(s)");case"week":return __("Week(s)");case"month":return __("Month(s)");case"year":return __("Year(s)");default:return e}};return i.map((e=>({label:n(e),id:e})))})(n),a=(0,d.xW)(),{currency_decimals:o,currency_symbol:c,currency_thousands:p,decimals_num:u}=null!==i&&void 0!==i?i:(null===(r=window.react_default_vars)||void 0===r?void 0:r.currency_info)||{},{_sale_price_enabled:x,_sale_price_schedule_enabled:_,_billing_cycle_type:h}=a.watch(),{isLoading:m}=C(),b=[{label:__("Limited"),id:"limited"},{label:__("Until Cancelled"),id:"until_cancelled"}];return(0,y.jsx)(L,{title:__("Pricing"),children:(0,y.jsxs)(t.s,{direction:"column",gap:"20px",children:[(0,y.jsx)(R,{isLoading:m,skeleton:(0,y.jsxs)(t.s,{align:"flex-end",gap:"10px",flex:"1",children:[(0,y.jsx)(W,{titleWidth:"80px"}),(0,y.jsx)(W,{titleWidth:"100px"}),(0,y.jsx)(W,{})]}),children:(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(D.oz,{name:"price",label:__("Price")+" (".concat(c,")"),decimalScale:u,decimalSeparator:o,thousandSeparator:p,withButtons:!0}),(0,y.jsx)(D.oz,{name:"recurring_value",label:__("Billing Interval"),withButtons:!0,min:"1"}),(0,y.jsx)(k.az,{alignSelf:"flex-end",w:"100%",children:(0,y.jsx)(D.zM,{name:"recurring_interval",options:s})})]})}),(0,y.jsx)(R,{isLoading:m,skeleton:(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(W,{titleWidth:"110px"}),(0,y.jsx)(W,{titleWidth:"120px"})]}),children:(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(D.zM,{name:"_billing_cycle_type",options:b,label:__("Billing Cycles Type")}),(0,y.jsx)(D.oz,{name:"billing_cycles",withButtons:!0,label:__("Number of Cycles"),hint:__("How many times the subscription will renew before ending"),isDisabled:"until_cancelled"===h})]})}),(0,y.jsx)(R,{isLoading:m,skeleton:(0,y.jsxs)(t.s,{gap:"20px",flexDirection:"column",children:[(0,y.jsx)(I.z,{w:"100%",h:"65px"}),(0,y.jsx)(I.z,{w:"100%",h:"225px"})]}),children:(0,y.jsxs)(t.s,{gap:"20px",flexDirection:"column",children:[(0,y.jsx)(O,{name:"_sale_price_enabled",title:__("Offer Sale Price")+" (".concat(c,")"),children:(0,y.jsx)(D.oz,{isDisabled:!x,name:"sale_price",withButtons:!0})}),(0,y.jsxs)(O,{name:"_sale_price_schedule_enabled",title:__("Sale Period"),inline:!1,children:[(0,y.jsxs)(t.s,{gap:"10px",w:"100%",mt:"20px",children:[(0,y.jsx)(D.Lh,{name:"sale_price_from",label:"Start Date",isDisabled:!_}),(0,y.jsx)(D.Kx,{name:"sale_price_from_time",label:__("Start Time"),isDisabled:!_})]}),(0,y.jsxs)(t.s,{gap:"10px",w:"100%",mt:"20px",children:[(0,y.jsx)(D.Lh,{name:"sale_price_to",label:"End Date",isDisabled:!_}),(0,y.jsx)(D.Kx,{name:"sale_price_to_time",label:__("End Time"),isDisabled:!_})]})]})]})})]})})};var B=i(95716),H=i(92070),q=i(82597),N=i(1648),Q=i(41024),F=i(38922),U=i(3234),Y=i(23585),G=i(54732);const V=e=>{let{field:r,onRemove:i}=e;const{attributes:n,listeners:l,setNodeRef:s,transform:o,transition:c}=(0,N.gl)({id:r.id}),d={transform:Q.Ks.Translate.toString(o),transition:c};return(0,y.jsxs)(t.s,(0,a.A)((0,a.A)({py:"10px",borderBottom:"1px solid",borderColor:"border",align:"center",gap:"20px",minH:"50px",h:"fit-content",whiteSpace:"wrap",ref:s,style:d},n),{},{cursor:"auto",children:[(0,y.jsx)(B.I,(0,a.A)((0,a.A)({},l),{},{cursor:"move",w:"9px",height:"15px",color:"dark50",as:U.h})),(0,y.jsx)(z.E,{lineHeight:"normal",color:"dark",fontSize:"16px",fontWeight:"medium",children:r.title}),(0,y.jsx)(B.I,{onClick:i,ml:"auto",color:"dark50",width:"16px",height:"16px",as:F.h,_hover:{color:"error",cursor:"pointer"}})]}))},K=()=>{const{__:__}=(0,l.WD)(),[e,r]=(0,c.useState)(""),i=(0,Y.FR)((0,Y.MS)(Y.AN)),{isLoading:n}=C(),{fields:a,remove:o,move:p,append:u}=(0,d.jz)({name:"plan_features"}),x=()=>{u({title:e}),r("")},_=(0,c.useCallback)((e=>{var r;const[i,n]=(0,G.Jq)(a,[e.active.id,null===(r=e.over)||void 0===r?void 0:r.id]);p(i,n)}),[a,p]);return(0,y.jsxs)(L,{title:__("Plan Features"),children:[(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(t.s,{flexDirection:"column",gap:"20px",children:(0,y.jsxs)(k.az,{children:[(0,y.jsx)(H.c,{color:"border"}),Array(3).fill(0).map(((e,r)=>(0,y.jsxs)(t.s,{gap:"20px",align:"center",h:"50px",borderBottom:"1px solid",borderColor:"border",children:[(0,y.jsx)(I.z,{w:"10px",h:"15px",borderRadius:"2px"}),(0,y.jsx)(I.z,{w:"".concat(70*(r+1),"px"),h:"19px"}),(0,y.jsx)(I.z,{w:"16px",h:"16px",ml:"auto",borderRadius:"2px"})]},r)))]})}),children:(0,y.jsxs)(k.az,{children:[(0,y.jsx)(H.c,{color:"border"}),(0,y.jsx)(Y.Mp,{sensors:i,collisionDetection:Y.fp,onDragEnd:_,children:(0,y.jsx)(N.gB,{items:a,strategy:N._G,children:a.map(((e,r)=>(0,y.jsx)(V,{onRemove:()=>o(r),field:e},e.id)))})})]})}),(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(q.p,{variant:"msVariant",placeholder:__("Enter feature"),value:e,isDisabled:n,onInput:e=>r(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&x()}}),(0,y.jsx)(s.$,{m:"0",variant:"primary",onClick:x,isDisabled:n,children:__("Add")})]})]})},Z=e=>{let{certificateEnabled:r}=e;const{__:__}=(0,l.WD)(),i=(0,d.xW)(),{isLoading:n}=C(),{_enrollment_fee_enabled:s,_trial_period_enabled:a,is_featured:o}=i.watch();return(0,y.jsx)(L,{title:__("Additional"),children:(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsxs)(t.s,{flexDirection:"column",gap:"20px",children:[(0,y.jsx)(I.z,{w:"100%",h:"65px"}),(0,y.jsx)(I.z,{w:"100%",h:"65px"}),(0,y.jsx)(I.z,{w:"100%",h:"65px"}),(0,y.jsx)(I.z,{w:"100%",h:"65px"})]}),children:(0,y.jsxs)(t.s,{flexDirection:"column",gap:"10px",children:[(0,y.jsx)(O,{name:"_trial_period_enabled",title:__("Trial Period (days)"),children:(0,y.jsx)(D.oz,{name:"trial_period",withButtons:!0,isDisabled:!a})}),(0,y.jsx)(O,{name:"is_featured",title:__("Mark as Featured"),children:(0,y.jsx)(D.A_,{name:"featured_text",placeholder:__("Enter featured badge label"),isDisabled:!o})}),r&&(0,y.jsx)(O,{name:"_is_not_certified",title:__("Do Not Provide Certificate"),inline:!1})]})})})},$=()=>{var e;const{__:__}=(0,l.WD)(),{formProps:r}=C();return(0,y.jsx)(d.Op,(0,a.A)((0,a.A)({},r),{},{children:(0,y.jsxs)(t.s,{gap:"20px",flex:"1",flexDirection:"column",children:[(0,y.jsx)(T,{}),(0,y.jsx)(A,{}),(0,y.jsx)(K,{}),(0,y.jsx)(Z,{certificateEnabled:null===(e=window.react_default_vars)||void 0===e?void 0:e.enabled_addons.certificate_builder})]})}))};var J=i(71624),X=i(61278),ee=i(77482);const re=e=>{let{customBlockProps:r}=e;const{__:__}=(0,l.WD)(),{formProps:i,isLoading:n}=C(),{name:s,description:a,price:o,sale_price:c,plan_features:d,is_featured:p,featured_text:u,recurring_interval:x,_sale_price_enabled:h,_sale_price_schedule_enabled:m,sale_price_from:b,sale_price_from_time:f,sale_price_to:g,sale_price_to_time:j,_trial_period_enabled:w,trial_period:v,_is_not_certified:P}=i.watch(),S=null!==r&&void 0!==r?r:{position:"sticky",top:"125px",overflow:"hidden"};return(0,y.jsxs)(L,{title:__("Plan Summary:"),flexProps:S,children:[(0,y.jsx)(H.c,{color:"border"}),(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(I.z,{width:"80px",h:"12px"}),children:p&&u&&(0,y.jsx)(k.az,{overflow:"hidden",maxW:"100%",children:(0,y.jsx)(z.E,{textTransform:"uppercase",fontWeight:"bold",color:"white",bg:"primary",borderRadius:"4px",fontSize:"10px",p:"3px 5px",letterSpacing:"1px",lineHeight:"normal",w:"fit-content",maxW:"100%",isTruncated:!0,children:u})})}),(0,y.jsxs)(t.s,{direction:"column",gap:"5px",children:[(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(I.z,{w:"140px",h:"29px"}),children:s&&(0,y.jsx)(z.E,{color:"dark",fontSize:"24px",fontWeight:"semibold",lineHeight:"normal",children:s})}),(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsxs)(t.s,{flexDirection:"column",gap:"4px",children:[(0,y.jsx)(I.z,{w:"100%",h:"17px"}),(0,y.jsx)(I.z,{w:"180px",h:"17px"})]}),children:!!a&&(0,y.jsx)(z.E,{color:"dark70",fontSize:"14px",fontWeight:"400",lineHeight:"19.6px",children:a})})]}),(0,y.jsxs)(t.s,{direction:"column",gap:"10px",children:[(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(t.s,{flexDirection:"column",children:(0,y.jsxs)(t.s,{alignItems:"flex-end",gap:"2px",fontSize:"16px",color:"dark70",fontWeight:"400",children:[(0,y.jsx)(I.z,{w:"103px",h:"32px"}),"/",(0,y.jsx)(I.z,{w:"68px",h:"18px"})]})}),children:(0,y.jsxs)(k.az,{children:[(0,y.jsxs)(z.E,{color:"dark",fontSize:"30px",fontWeight:"bold",lineHeight:"normal",children:[(0,y.jsx)(ee.x,{price:h&&c?c:o}),(0,y.jsxs)(z.E,{as:"span",fontSize:"16px",color:"dark70",fontWeight:"400",children:["/",x]})]}),h&&(0,y.jsx)(z.E,{color:"dark70",fontSize:"20px",fontWeight:"400",textDecoration:"line-through",lineHeight:"normal",children:(0,y.jsx)(ee.x,{price:o})})]})}),(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsxs)(t.s,{flexDirection:"column",gap:"4px",children:[(0,y.jsx)(I.z,{maxW:"232px",h:"19px",w:"100%"}),(0,y.jsx)(I.z,{maxW:"122px",h:"19px",w:"100%"})]}),children:m&&(0,y.jsxs)(t.s,{gap:"5px",align:"flex-start",children:[(0,y.jsx)(B.I,{mt:"5px",as:J.h}),(0,y.jsxs)(k.az,{children:[(0,y.jsxs)(z.E,{color:"dark70",fontSize:"14px",fontWeight:"400",lineHeight:"19.6px",children:[__("Sale available from")," ",(0,y.jsxs)(z.E,{as:"span",fontWeight:"bold",children:[b?(0,_.GP)(new Date(b),"dd.MM.yyyy"):"","\xa0",null!==f&&void 0!==f?f:"00:00"]})]}),(0,y.jsxs)(z.E,{color:"dark70",fontSize:"14px",fontWeight:"400",lineHeight:"19.6px",children:[__("to")," ",(0,y.jsxs)(z.E,{as:"span",fontWeight:"bold",children:[g?(0,_.GP)(new Date(g),"dd.MM.yyyy"):"","\xa0",null!==j&&void 0!==j?j:"00:00"]})]})]})]})})]}),(0,y.jsx)(H.c,{color:"border"}),(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(t.s,{direction:"column",gap:"10px",children:Array(3).fill(0).map(((e,r)=>(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(I.z,{w:"18px",h:"18px",borderRadius:"50%"}),(0,y.jsx)(I.z,{w:"".concat(50*(r+1),"px")})]},r)))}),children:!(null===d||void 0===d||!d.length)&&(0,y.jsx)(t.s,{direction:"column",gap:"10px",children:d.map((e=>(0,y.jsxs)(t.s,{gap:"10px",align:"center",children:[(0,y.jsx)(t.s,{w:"18px",h:"18px",bg:"primary",borderRadius:"50%",align:"center",justify:"center",flexShrink:"0",children:(0,y.jsx)(B.I,{w:"10px",h:"8px",color:"white",as:X.h})}),(0,y.jsx)(z.E,{color:"dark",fontSize:"16px",fontWeight:"medium",lineHeight:"normal",children:e.title})]},e.title)))})}),(0,y.jsx)(t.s,{children:(0,y.jsx)(R,{isLoading:n,skeleton:(0,y.jsx)(I.z,{width:"300px",h:"18px"}),children:(0,y.jsxs)(z.E,{color:"dark70",fontSize:"14px",fontWeight:"400","line-height":"140%",children:[w?"".concat(v," ").concat(__("day(s) free trial")," "):"",w&&!P&&"\u2022 ",P?"":__("Certificate included")]})})})]})},ie=()=>{const{__:__}=(0,l.WD)();return(0,y.jsxs)(t.s,{px:"55px",gap:"20px",w:"100%",maxW:"1170px",mx:"auto",children:[(0,y.jsx)($,{}),(0,y.jsx)(k.az,{maxW:"450px",flex:"1",children:(0,y.jsx)(re,{})})]})},ne=e=>{let{setPage:r}=e;const{__:__}=(0,l.WD)(),{onCreate:i,isCreating:a,isLoading:o,isEdit:c,editId:d,formProps:p}=C(),u=p.formState.isDirty;return(0,y.jsx)(n.HT,{title:d?__("Membership plan #")+d:__("Create New Membership Plan"),headerProps:{mb:"20px",position:"sticky",top:"32px",zIndex:"99"},onBack:()=>r(E.LIST),button:(0,y.jsx)(t.s,{gap:"10px",children:(0,y.jsx)(s.$,{m:"0",variant:"primary",onClick:i,fontWeight:"bold",isLoading:a,isDisabled:a||o||!u,children:__(c?"Save":"Create")})}),children:(0,y.jsx)(ie,{})})},le=e=>{let{setPage:r,editId:i}=e;return(0,y.jsx)(S,{editId:i,children:(0,y.jsx)(ne,{setPage:r})})};var te=i(82256);const se=(0,c.createContext)(null),ae=e=>{let{children:r}=e;const{page:i,perPage:n}=(0,te.pH)(),[l,t]=(0,c.useState)(i||1),[s,a]=(0,c.useState)(0),[o,d]=(0,c.useState)(n||10),{sort:u,onSort:x}=(0,te.y8)(),_=((e,r,i,n)=>{const l=(0,j.gf)();return(0,p.useQuery)({queryKey:["membership-plans",e,r,i],queryFn:async()=>{const t=await l.membershipPlans.getMembershipPlans(e,r,i);return null===n||void 0===n||n(t),t}})})(l,o,u);return(0,c.useEffect)((()=>{_.data&&a((()=>_.data.total))}),[_.data]),(0,y.jsx)(se.Provider,{value:{page:l,setPage:t,perPage:o,setPerPage:d,membershipPlansQuery:_,total:s,sort:u,onSort:x},children:_.error?(0,y.jsx)(k.az,{children:"Error"}):r})};var oe,ce=i(79523),de=i(23867);const pe=["title","titleId"];function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ue.apply(null,arguments)}function xe(e,r){let{title:i,titleId:n}=e,l=function(e,r){if(null==e)return{};var i,n,l=function(e,r){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;i[n]=e[n]}return i}(e,r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(n=0;n<t.length;n++)i=t[n],r.indexOf(i)>=0||{}.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}(e,pe);return c.createElement("svg",ue({width:15,height:14,viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":n},l),i?c.createElement("title",{id:n},i):null,oe||(oe=c.createElement("path",{d:"M14.5908 5.60601C14.6607 5.23917 14.3809 4.79896 14.0312 4.79896L10.0443 4.21202L8.22568 0.396887C8.15574 0.250151 8.08579 0.176783 7.9459 0.103415C7.59617 -0.116689 7.17649 0.0300471 6.96665 0.396887L5.218 4.21202L1.23108 4.79896C1.02124 4.79896 0.881347 4.87233 0.811401 5.01907C0.531616 5.31254 0.531616 5.75275 0.811401 6.04622L3.67919 8.98093L2.97973 13.1629C2.97973 13.3096 2.97973 13.4564 3.04967 13.6031C3.25951 13.97 3.67919 14.1167 4.02892 13.8966L7.59617 11.9157L11.1634 13.8966C11.2334 13.97 11.3733 13.97 11.5131 13.97C11.5831 13.97 11.5831 13.97 11.653 13.97C12.0028 13.8966 12.2826 13.5297 12.2126 13.0895L11.5131 8.90757L14.3809 5.97285C14.5208 5.89948 14.5908 5.75275 14.5908 5.60601Z",fill:"#227AFF"})))}const _e=c.forwardRef(xe),he=(i.p,e=>{const{__:__}=(0,l.TO)();switch(e){case"day":return __("Daily");case"week":return __("Weekly");case"month":return __("Monthly");case"year":return __("Yearly");default:return e}}),me=e=>{const{__:__}=(0,l.TO)();switch(e){case"full_site":return __("Sitewide");case"category":return __("Category-based");case"course":return __("Course-based");case"bundle":return __("Bundle-based");default:return e}};var be=i(48894);const fe=()=>{var e;return(0,y.jsxs)(be.Tr,{background:"white",children:[(0,y.jsx)(te.Us,{children:(0,y.jsx)(k.az,{w:"20px",children:(0,y.jsx)(I.z,{w:"20px",h:"20px"})})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"100px",h:"20px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"120px",h:"20px"})}),(null===(e=window.react_default_vars)||void 0===e?void 0:e.enabled_addons.certificate_builder)&&(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"80px",h:"20px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"120px",h:"20px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"100px",h:"20px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"110px",h:"18px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsx)(I.z,{w:"34px",h:"20px"})}),(0,y.jsx)(te.Us,{children:(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(k.az,{w:"65px",children:(0,y.jsx)(I.z,{w:"65px",h:"40px"})}),(0,y.jsx)(k.az,{w:"40px",children:(0,y.jsx)(I.z,{w:"40px",h:"40px"})})]})})]})},ge=e=>{let{onError:r,onSuccess:i}=e;const n=(0,j.gf)();return(0,p.useMutation)((async e=>{let[r,i]=e;return await n.membershipPlans.updateMembershipPlanStatus(r,i),r}),{onError:e=>{r(e)},onSuccess:e=>{i(e)}})},je=e=>{let{onError:r,onSuccess:i}=e;const n=(0,j.gf)();return(0,p.useMutation)((async e=>(await n.membershipPlans.deleteMembershipPlan(e),e)),{onError:r,onSuccess:i})},we=e=>{let{onError:r,abortRef:i}=e;const n=(0,j.gf)();let l;return(0,u.Rw)((e=>{let[[r,i],{signal:t}]=e;return l=r,n.membershipPlans.reorderMembershipPlans(i,t)}),{onError:e=>{r(e,l)},abortRef:i})};var ve=i(11837),ye=i(41262);const Pe=e=>{var r,i,n;let{onRowClick:a}=e;const{__:__}=(0,l.WD)(),{membershipPlansQuery:o,page:d,perPage:x,sort:_,total:h,onSort:m,setPage:b,setPerPage:f}=(()=>{const e=(0,c.useContext)(se);if(!e)throw new Error("useListMembershipPlansContext must be used within an ListMembershipPlansProvider");return e})(),{showErrorToast:g}=(0,u.Ax)(),j=(0,p.useQueryClient)(),[w,v]=(0,c.useState)([]),[P,S]=(0,c.useState)([]),C=(0,c.useRef)(new AbortController),{mutate:E,isLoading:k}=ge({onError:e=>{g(e)},onSuccess:e=>{v((r=>(r.splice(r.findIndex((r=>r===e)),1),r))),j.setQueryData(["membership-plans",d,x,_],(r=>{if(!r)return r;const i=r.subscription_plans.find((r=>r.id===e));return i&&(i.is_enabled="1"===i.is_enabled?"0":"1"),r}))}}),{mutate:D,isLoading:L}=je({onError:(e,r)=>{g(e),S((e=>(e.splice(e.findIndex((e=>e===r)),1),e)))},onSuccess:async e=>{1===P.length&&j.invalidateQueries(["membership-plans",d,x,_]),S((r=>(r.splice(r.findIndex((r=>r===e)),1),r)))}}),{mutate:I,isLoading:W}=we({onError:(e,r)=>{g(e),j.setQueryData(["membership-plans",d,x,_],(e=>(null!==e&&void 0!==e&&e.subscription_plans&&(e.subscription_plans=r),e)))},abortRef:C}),R=e=>w.includes(e)&&k,M=e=>P.includes(e)&&L,T=[{label:__("Plan Title"),key:"name",breakWords:!0,rowRenderer:e=>(0,y.jsxs)(t.s,{align:"center",gap:"10px",children:[(0,y.jsx)(z.E,{lineHeight:"normal",children:e.name}),Boolean(parseInt(e.is_featured))&&(0,y.jsx)(B.I,{as:_e,w:"14px",h:"14px",lineHeight:"normal"})]})},{label:__("Access Type"),width:"150px",isSortable:!0,key:"type",rowRenderer:e=>(0,y.jsx)(z.E,{children:me(e.type)})},{label:__("Renewal Period"),width:"140px",key:"recurring_interval",isSortable:!0,rowRenderer:e=>(0,y.jsx)(z.E,{children:he(e.recurring_interval)})},{label:__("Certificate"),width:"130px",key:"is_certified",isSortable:!0,condition:null!==(r=null===(i=window.react_default_vars)||void 0===i?void 0:i.enabled_addons.certificate_builder)&&void 0!==r&&r,rowRenderer:e=>(0,y.jsx)(z.E,{children:parseInt(e.is_certified)?__("Included"):__("No certificate")})},{label:__("Trial"),width:"100px",key:"trial",isSortable:!0,rowRenderer:e=>(0,y.jsx)(z.E,{children:parseInt(e.trial_period)?"".concat(e.trial_period," ").concat(__("day(s)")):__("No trial")})},{label:__("Price"),key:"price",width:"200px",isSortable:!0,rowRenderer:e=>{var r;return(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(z.E,{color:"dark",fontWeight:"500",fontSize:"16px",children:(0,y.jsx)(ee.x,{price:null!==(r=e.sale_price)&&void 0!==r?r:e.price})}),e.sale_price&&(0,y.jsx)(z.E,{textDecoration:"line-through",color:"dark70",fontSize:"16px",fontWeight:"500",children:(0,y.jsx)(ee.x,{price:e.price})})]})}},{label:__("Status"),key:"is_enabled",width:"40px",isSortable:!0,rowRenderer:e=>{const r=R(e.id);return(0,y.jsxs)(t.s,{onClick:e=>e.stopPropagation(),align:"center",gap:"5px",children:[(0,y.jsx)(ce.d,{mr:"0",onChange:()=>(e=>{if(w.includes(e.id))return;const r=Boolean(parseInt(e.is_enabled));v((r=>(r.push(e.id),r))),E([e.id,{is_enabled:!r}])})(e),isChecked:Boolean(parseInt(e.is_enabled)),isDisabled:r||M(e.id)}),(0,y.jsx)(de.y,{visibility:r?"visible":"hidden",size:"sm",color:"primary"})]})}},{label:"",key:"actions",width:"1%",rowRenderer:e=>{const r=M(e.id);return(0,y.jsxs)(t.s,{gap:"10px",children:[(0,y.jsx)(s.$,{variant:"defaultLight",m:"0",isDisabled:r||R(e.id),children:__("Edit")}),(0,y.jsx)(s.$,{variant:"error-tonal",m:"0",w:"40px",onClick:r=>((e,r)=>{e.stopPropagation(),P.includes(r.id)||(0,u.SC)((()=>{S((e=>(e.push(r.id),e))),D(r.id)}),__("Do you really want to delete this plan?"))()})(r,e),isLoading:r,isDisabled:r||R(e.id),children:(0,y.jsx)(B.I,{as:F.h})})]})}}];return(0,y.jsx)(te.bQ,{headers:T,data:(null===(n=o.data)||void 0===n?void 0:n.subscription_plans)||[],page:d,total:h,perPage:x,isLoading:o.isLoading||o.isRefetching,sort:_,onRowClick:e=>{return r=e.id,void(R(r)||M(r)||a(r));var r},onPageChange:b,onPerPageChange:e=>{b(1),f(e)},onSort:m,onDragEnd:e=>{W&&C.current.abort(),j.setQueryData(["membership-plans",d,x,_],(r=>{var i;const n=null===r||void 0===r?void 0:r.subscription_plans;if(!n)return r;if(null!==(i=e.over)&&void 0!==i&&i.id){const i=n.findIndex((r=>r.id===e.active.id)),l=n.findIndex((r=>r.id===e.over.id));void 0!==i&&void 0!==l&&(r.subscription_plans=(0,ve.Q)(n,i,l,"plan_order"),I([n,r.subscription_plans]))}return r}))},headerProps:{borderTop:"1px solid",borderColor:"border"},isSelectable:!1,isSortable:!0,SkeletonCells:(0,y.jsx)(fe,{}),noItemsIcon:(0,y.jsx)(ye.h,{}),noItemsTitle:__("No Membership Plans yet"),noItemsSubTitle:__("All information about your membership plans will be displayed here")})},Se=e=>{let{setPage:r,onRowClick:i}=e;const{__:__}=(0,l.WD)();return(0,y.jsx)(ae,{children:(0,y.jsx)(n.HT,{title:__("Membership Plans"),button:(0,y.jsx)(s.$,{m:"0",variant:"primary",onClick:()=>r(E.CREATE),fontWeight:"bold",children:__("Add New Plan")}),children:(0,y.jsx)(Pe,{onRowClick:i})})})};var Ce=i(27281);const Ee=()=>{const[e,r]=(0,c.useState)((0,x.a)(["plan_id"]).plan_id?E.CREATE:E.LIST),[i,n]=(0,c.useState)((()=>{const e=(0,x.a)(["plan_id"]);return e.plan_id?parseInt(e.plan_id):null})());return(0,c.useEffect)((()=>{e===E.LIST&&(window.scroll(0,0),n(null),(0,x.L)({plan_id:void 0}))}),[e]),(0,u.wD)({eventFn:()=>{const e=(0,x.a)(["plan_id"]);e.plan_id?(window.scroll(0,0),r(E.CREATE),n(parseInt(e.plan_id))):(window.scroll(0,0),r(E.LIST),n(null))}}),(0,y.jsxs)(Ce.p,{defaultValue:e,children:[(0,y.jsx)(Ce.a,{value:E.LIST,children:(0,y.jsx)(Se,{setPage:r,onRowClick:e=>{window.scroll(0,0),r(E.CREATE),n(e),(0,x.L)({plan_id:e.toString()},!1)}})}),(0,y.jsx)(Ce.a,{value:E.CREATE,children:(0,y.jsx)(le,{setPage:r,editId:i})})]})}}}]);
"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[856,949],{56880:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var i=n(27281),s=n(61667),a=n(34688),l=n(99887),r=n(31590),o=n(82597),d=n(95716),c=n(59579),u=n(65043),p=n(79478),x=n(82256),h=n(79060),b=n(81919),v=n(82907),m=n(51585);const g=function(e,t,n,i,s,a,l,r){let o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;const d=(0,m.gf)();return(0,v.useQuery)({queryKey:["memberships",e,t,n,i,s,a,l,r],queryFn:async()=>{const c="all"===i?"":i,u="all"===s?(e=>{switch(e){case b.c1.MEMBERSHIP:return[b.VM.CATEGORY,b.VM.SITE];case b.c1.SUBSCRIPTION:return[b.VM.COURSE];default:return[]}})(r):[s];return await d.memberships.getMemberships(e,t,n,c,u,a,l,o)}})};var w=n(31001),j=n(70579);const y=(0,u.createContext)(null),S=e=>{let{children:t}=e;const{page:n,perPage:i}=(0,x.pH)(),[s,a]=(0,u.useState)(n||1),[l,o]=(0,u.useState)(i||10),[d,c]=(0,u.useState)(""),[v,m]=(0,u.useState)("all"),[S,_]=(0,u.useState)("all"),[k,f]=(0,u.useState)((0,h.Fw)("memberships")),[C,E]=(0,u.useState)([]),{sort:R,onSort:T}=(0,x.y8)(),[P,I]=(0,u.useState)(0),[M,W]=(0,u.useState)((()=>{const e=(0,w.a)(["tab"]);return e.tab?e.tab:b.c1.SUBSCRIPTION})),D=(0,p.d7)(d,500),z=g(s,l,D,v,S,k,R,M,!0);(0,u.useEffect)((()=>{z.data&&I(z.data.recordsTotal)}),[z.data]),(0,u.useEffect)((()=>{_("all")}),[M]);return(0,j.jsx)(y.Provider,{value:{page:s,setPage:a,perPage:l,setPerPage:o,search:d,setSearch:c,status:v,setStatus:m,type:S,setType:_,membershipsQuery:z,total:P,setDateRange:f,selectedMemberships:C,setSelectedMemberships:E,sort:R,onSort:T,tab:M,setTab:e=>{(0,w.L)({tab:e},!1),W(e)}},children:z.error?(0,j.jsx)(r.az,{children:"Error"}):t})},_=()=>{const e=(0,u.useContext)(y);if(!e)throw new Error("useMembershipsContext must be used within an MembershipsProvider");return e};var k=n(95426),f=n(3898),C=n(41262);const E=()=>{const e=(0,m.gf)(),t=(0,v.useQueryClient)();return(0,v.useMutation)({mutationFn:async t=>e.memberships.bulkAction({action:t.action,memberships:t.items}),onSuccess:()=>{t.invalidateQueries({queryKey:["memberships"]})}})};var R=n(7297);const T=e=>{switch(e){case"active":return"success";case"pending":return"warning";case"on_hold":case"expired":return"error";case"trialing":case"trial":return"primary";default:return"gray"}},P=e=>{const{__:__}=(0,s.TO)();switch(e){case"active":return __("Active");case"pending":return __("Pending");case"on_hold":return __("On Hold");case"expired":return __("Expired");case"trialing":case"trial":return __("Trial");case"approval_pending":return __("Approval Pending");default:return e}},I=e=>{let{status:t}=e;return(0,j.jsx)(R.v,{text:P(t),color:T(t)})};var M=n(48894),W=n(21989),D=n(19316);const z=()=>{var e,t;const n=null!==(e=null===(t=window.react_memberships)||void 0===t?void 0:t.taxes_info.taxes_enabled)&&void 0!==e&&e;return(0,j.jsxs)(M.Tr,{background:"white",children:[(0,j.jsx)(x.Us,{children:(0,j.jsx)(r.az,{w:"20px",children:(0,j.jsx)(D.z,{w:"20px",h:"20px"})})}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"80px",h:"20px"})}),(0,j.jsx)(x.Us,{children:(0,j.jsxs)(W.s,{gap:"3px",flexDirection:"column",children:[(0,j.jsx)(D.z,{w:"200px",h:"18px"}),(0,j.jsx)(D.z,{w:"100px",h:"14px"})]})}),n&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"120px",h:"20px"})}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"120px",h:"20px"})})]}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"120px",h:"20px"})}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"100px",h:"20px"})}),(0,j.jsx)(x.Us,{children:(0,j.jsxs)(W.s,{flexDirection:"column",gap:"3px",children:[(0,j.jsx)(D.z,{w:"110px",h:"18px"}),(0,j.jsx)(D.z,{width:"110px",h:"18px"})]})}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"100px",h:"20px"})}),(0,j.jsx)(x.Us,{children:(0,j.jsx)(D.z,{w:"70px",h:"40px",fixedWidth:!0})})]})};var L=n(76586),U=n(77482),A=n(89379),F=n(53536),H=n(42703),V=n(54765),B=n(57076);const N=e=>{const{__:__}=(0,s.WD)();return(0,j.jsxs)(B.c.SingleValue,(0,A.A)((0,A.A)({},e),{},{children:[__("Type"),": ",e.data.label]}))},O=e=>{let{onChange:t,value:n,includeAll:i,isSelectField:a,name:l,tab:r}=e;const{__:__}=(0,s.WD)(),o=e=>{switch(e){case b.VM.COURSE:return __("Course-based");case b.VM.BUNDLE:return __("Bundle-based");case b.VM.SITE:return __("Sitewide");case b.VM.CATEGORY:return __("Category-based");default:return(0,F.capitalize)(e)}},d=[{id:b.VM.COURSE,label:o(b.VM.COURSE)}],c=[{id:b.VM.SITE,label:o(b.VM.SITE)},{id:b.VM.CATEGORY,label:o(b.VM.CATEGORY)}],p=(0,u.useMemo)((()=>{const e=[];switch(i&&e.push({id:"all",label:__("All")}),r){case b.c1.MEMBERSHIP:e.push(...c);break;case b.c1.SUBSCRIPTION:e.push(...d);break;default:e.push(...c,...d)}return e}),[r]);return a&&l?(0,j.jsx)(V.zM,{name:l,options:p}):r===b.c1.SUBSCRIPTION?null:(0,j.jsx)(H.l,{placeholder:__("Subscription type"),options:p,value:n,onChange:e=>null===t||void 0===t?void 0:t(e),components:{SingleValue:N}})},Q=e=>{var t,n,i,p,v,m;let{onRowClick:g}=e;const{__:__}=(0,c.WD)(),w=(()=>{const{__:__}=(0,s.WD)();return[{id:"delete",label:__("Delete")}]})(),{page:y,setPage:S,perPage:R,setPerPage:T,membershipsQuery:P,total:M,search:W,setSearch:D,setDateRange:A,selectedMemberships:F,setSelectedMemberships:H,sort:V,onSort:B,tab:N,type:Q,setType:q}=_(),K=e=>{S(1),H([]),e()},$=e=>(0,k.k)(new Date(e));(0,u.useEffect)((()=>{H([])}),[y]);const G=[{label:__("ID"),key:"id",width:"50px",isSortable:!0,rowRenderer:e=>(0,j.jsxs)(a.E,{children:["#",e.id]})},N===b.c1.MEMBERSHIP?{label:__("Plan Title"),key:"plan",rowRenderer:e=>(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(a.E,{children:e.plan}),(0,j.jsx)(a.E,{color:"dark70",fontSize:"12px",children:(0,L.getType)(e.type)})]})}:{label:__("Name"),key:"plan",rowRenderer:e=>{var t,n;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(a.E,{children:null!==(t=null===(n=e.course)||void 0===n?void 0:n.title)&&void 0!==t?t:""}),(0,j.jsxs)(a.E,{color:"dark70",fontSize:"12px",children:[__("Plan"),": ",e.plan]})]})}},{label:__("Subtotal"),key:"subtotal",width:"120px",condition:null!==(t=null===(n=window.react_memberships)||void 0===n?void 0:n.taxes_info.taxes_enabled)&&void 0!==t&&t,rowRenderer:e=>(0,j.jsx)(U.x,{price:e.subtotal})},{label:__("Tax"),key:"taxes",width:"120px",condition:null!==(i=null===(p=window.react_memberships)||void 0===p?void 0:p.taxes_info.taxes_enabled)&&void 0!==i&&i,rowRenderer:e=>(0,j.jsx)(U.x,{price:e.taxes})},{label:__("Total"),key:"amount",width:"150px",rowRenderer:e=>(0,j.jsxs)(a.E,{children:[(0,j.jsx)(U.x,{price:e.total}),"/",e.interval]})},{label:__("User"),key:"user",width:"100px"},{label:__("Period"),key:"date",width:"140px",rowRenderer:e=>(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(a.E,{children:[$(e.date).date," \u2014"]}),(0,j.jsx)(a.E,{children:e.autoRenew?$(e.autoRenew).date:"-"})]})},{label:__("Status"),key:"status",width:"100px",isSortable:!0,rowRenderer:e=>(0,j.jsx)(I,{status:e.status})},{label:"",key:"actions",width:"1%",rowRenderer:()=>(0,j.jsx)(l.$,{variant:"defaultLight",m:"0",children:__("View")})}];return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(f.Qn,{selectedItems:F,setSelectedItems:H,getItemId:e=>e.id,totalItems:M,dataItems:(null===(v=P.data)||void 0===v?void 0:v.data)||[],onDateRangeChange:(e,t)=>A((0,h.uo)(e,t)),bulkActions:w,useBulkAction:E,bulkActionGuard:{delete:__("Are you sure you want to delete these memberships?")},datePickerLocalStorageKey:"memberships",children:[(0,j.jsx)(r.az,{maxW:"180px",w:"100%",children:(0,j.jsx)(O,{includeAll:!0,onChange:e=>K((()=>q(e))),value:Q,tab:N})}),(0,j.jsx)(r.az,{maxW:"250px",w:"100%",children:(0,j.jsx)(o.p,{placeholder:__("Search by name"),variant:"msVariant",value:W,onChange:e=>K((()=>D(e.target.value)))})})]}),(0,j.jsx)(x.bQ,{headers:G,data:(null===(m=P.data)||void 0===m?void 0:m.data)||[],selectedItems:F,page:y,total:M,perPage:R,isLoading:P.isLoading||P.isRefetching,onPageChange:S,onSelectItem:e=>{return t=e.id,void(F.includes(t)?H(F.filter((e=>e!==t))):H([...F,t]));var t},onRowClick:e=>g(e.id),onPerPageChange:e=>K((()=>T(e))),sort:V,onSort:B,noItemsIcon:(0,j.jsx)(d.I,{as:C.h,w:"24px",h:"24px"}),SkeletonCells:(0,j.jsx)(z,{})})]})};var q=n(97469),K=n(22412);const $=(0,q.B)(W.s,{baseStyle:{w:"100%",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"4px",height:"100%",transition:"background 0.2s",fontSize:"14px",fontWeight:"500",color:"dark",_selected:{background:"white!important",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.07)"},_hover:{background:"rgba(255, 255, 255, 0.5)"}}}),G=e=>{let{onRowClick:t}=e;const{__:__}=(0,s.WD)(),{tab:n,setTab:i}=_();return(0,j.jsx)(f.HT,{title:__("Subscriptions & Memberships"),button:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(W.s,{p:"4px",height:"40px",alignItems:"center",w:"350px",borderRadius:"4px",background:"border",gap:"1px",children:[(0,j.jsx)($,{"aria-selected":n===K.c1.SUBSCRIPTION,onClick:()=>i(K.c1.SUBSCRIPTION),children:__("Subscriptions")}),(0,j.jsx)($,{"aria-selected":n===K.c1.MEMBERSHIP,onClick:()=>i(K.c1.MEMBERSHIP),children:__("Memberships")})]}),(0,j.jsx)(r.az,{flex:"1 0 0"})]}),children:(0,j.jsx)(Q,{onRowClick:t})})},Y=e=>{let{onRowClick:t}=e;return(0,j.jsx)(S,{children:(0,j.jsx)(G,{onRowClick:t})})};let J=function(e){return e.LIST="list",e.CREATE="create",e}({});const X=(0,u.createContext)(null),Z=e=>{let{children:t,id:n}=e;const{data:i,isLoading:s}=(e=>{const t=(0,c.gf)();return(0,v.useQuery)({queryKey:["membership",e],queryFn:()=>t.memberships.getMembership(e),enabled:!!e})})(n),[a,l]=(0,u.useState)(""),[r,o]=(0,u.useState)(!1),d=(0,v.useQueryClient)(),[p,x]=(0,u.useState)(0);(0,u.useEffect)((()=>{null!==i&&void 0!==i&&i.note&&l(null===i||void 0===i?void 0:i.note)}),[i]);const h=((e,t)=>{const n=(0,c.gf)();return(0,v.useMutation)({mutationFn:()=>n.memberships.updateMembership(e,{note:t})})})(n,a);return(0,j.jsx)(X.Provider,{value:{data:i,isLoading:s,subscriptionNote:a,setSubscriptionNote:l,updateMutation:h,id:n,isEditMode:r,setIsEditMode:o,handleSave:async()=>{if(status!==(null===i||void 0===i?void 0:i.status)||a!==(null===i||void 0===i?void 0:i.note))try{await h.mutateAsync(),d.invalidateQueries({queryKey:["memberships"]}),d.invalidateQueries({queryKey:["membership",n]}),o(!1)}catch(e){console.error(e)}},totalPaymentHistory:p,setTotalPaymentHistory:x},children:t})},ee=()=>{const e=(0,u.useContext)(X);if(!e)throw new Error("useDetailsContext must be used within an DetailsProvider");return e};var te=n(24943);const ne=e=>{let{children:t,items:n,title:i,isLoading:s}=e;return(0,j.jsxs)(W.s,{p:"20px",flexDirection:"column",bg:"white",borderRadius:"10px",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.07)",flex:"1 1 400px",h:"fit-content",children:[(0,j.jsx)(a.E,{mb:"20px",color:"dark",fontSize:"18px",fontWeight:"semibold",lineHeight:"normal",children:i}),n?n.map((e=>{let{label:t,value:n,skeletonW:i}=e;return(0,j.jsxs)(W.s,{justify:"space-between",align:"center",fontSize:"16px",color:"dark",gap:"10px",borderTop:"1px solid",borderColor:"border",h:"40px",children:[(0,j.jsxs)(a.E,{fontWeight:"500",children:[t,":"]}),s?(0,j.jsx)(D.z,{w:i,h:"18px"}):(0,j.jsx)(a.E,{fontWeight:"400",children:n})]},t)})):t]})};var ie=n(94223),se=n(61278),ae=n(5994);const le=()=>{const{isLoading:e,subscriptionNote:t,setSubscriptionNote:n,data:i,updateMutation:r,isEditMode:o,setIsEditMode:u,handleSave:p}=ee(),{isLoading:x}=r,{__:__}=(0,s.WD)(),h=(()=>{var e;const{data:t}=ee(),{__:__}=(0,c.WD)(),n=t&&t.trial_end_date?(0,k.k)(t.trial_end_date,"UTC"):null,i=t&&t.next_payment?(0,k.k)(t.next_payment,"UTC"):null,s=t&&t.start_date?(0,k.k)(t.start_date,"UTC"):null,a=t&&t.end_date?(0,k.k)(t.end_date,"UTC"):null;return[{label:__("Subscription ID"),value:"#".concat(null===t||void 0===t?void 0:t.id),skeletonW:"80px"},{label:__("Membership Access"),value:(0,L.getType)(null!==(e=null===t||void 0===t?void 0:t.membership_access)&&void 0!==e?e:""),skeletonW:"100px"},{label:__("Renew"),value:null!==t&&void 0!==t&&t.renew?"".concat(t.renew):null,skeletonW:"130px"},{label:__("Billing cycles"),value:null!==t&&void 0!==t&&t.plan_billing_cycles?"0"===(null===t||void 0===t?void 0:t.plan_billing_cycles)?__("Until Cancelled"):"".concat(null===t||void 0===t?void 0:t.plan_billing_cycles," ").concat(__("time(s)")):null,skeletonW:"70px"},{label:__("Timezone"),value:"+00:00",skeletonW:"100px"},{label:__("Trial End Date"),value:n?"".concat(n.date," ").concat(n.time):n,skeletonW:"140px",condition:!!n},{label:__("Start Date"),value:s?"".concat(s.date," ").concat(s.time):s,skeletonW:"140px",condition:!!s},{label:__("Next Payment Date"),value:i?"".concat(i.date," ").concat(i.time):i,skeletonW:"140px",condition:!!i},{label:__("End Date"),value:a?"".concat(a.date," ").concat(a.time):a,skeletonW:"140px",condition:!!a}].filter((e=>{let{condition:t}=e;return!1!==t}))})(),b=(()=>{var e,t,n,i,s,a,l,r;const{data:o}=ee(),{__:__}=(0,c.WD)(),{taxes_info:d}=window.react_memberships||{};return[{label:__("Name"),value:null===o||void 0===o||null===(e=o.student)||void 0===e?void 0:e.name,skeletonW:"120px"},{label:__("Email"),value:null===o||void 0===o||null===(t=o.student)||void 0===t?void 0:t.email,skeletonW:"140px"},{label:__("Country"),value:null===o||void 0===o||null===(n=o.student)||void 0===n?void 0:n.country,visible:null===d||void 0===d?void 0:d.country,skeletonW:"100px"},{label:__("Post Code"),value:null===o||void 0===o||null===(i=o.student)||void 0===i?void 0:i.postcode,visible:null===d||void 0===d?void 0:d.post_code,skeletonW:"80px"},{label:__("State"),value:null===o||void 0===o||null===(s=o.student)||void 0===s?void 0:s.state,visible:null===d||void 0===d?void 0:d.state,skeletonW:"90px"},{label:__("Town/City"),value:null===o||void 0===o||null===(a=o.student)||void 0===a?void 0:a.city,visible:null===d||void 0===d?void 0:d.city,skeletonW:"100px"},{label:__("Company Name"),value:null===o||void 0===o||null===(l=o.student)||void 0===l?void 0:l.company,visible:null===d||void 0===d?void 0:d.company,skeletonW:"120px"},{label:__("Phone Number"),value:null===o||void 0===o||null===(r=o.student)||void 0===r?void 0:r.phone_number,visible:null===d||void 0===d?void 0:d.phone,skeletonW:"140px"}].filter((e=>{let{visible:t}=e;return void 0===t||!0===t}))})();return(0,j.jsx)(W.s,{justify:"center",children:(0,j.jsxs)(W.s,{px:"20px",gap:"20px",flexWrap:"wrap",maxW:"1440px",w:"100%",children:[(0,j.jsx)(ne,{title:__("Subscription Details"),items:h,isLoading:e}),(0,j.jsx)(ne,{title:__("Student Details"),items:b,isLoading:e}),(0,j.jsx)(ne,{title:__("Subscription Note for Admin"),isLoading:e,children:(0,j.jsxs)(W.s,{position:"relative",minH:"168px",children:[o?(0,j.jsx)(te.T,{fontSize:"16px",fontWeight:"500",color:"dark70",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"4px",value:null!==t&&void 0!==t?t:void 0,onChange:e=>n(e.target.value),p:"10px"}):(0,j.jsx)(j.Fragment,{children:e?(0,j.jsx)(D.z,{w:"200px",h:"20px"}):(0,j.jsx)(a.E,{fontSize:"16px",fontWeight:"500",color:"dark70",whiteSpace:"pre-line",children:t||__("Add note")})}),(0,j.jsx)(W.s,{position:"absolute",bottom:"0",right:"0",gap:"5px",children:o?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l.$,{variant:"defaultLight",m:"0",w:"30px",h:"30px",p:"0",isDisabled:x,onClick:()=>{u(!1),n((null===i||void 0===i?void 0:i.note)||"")},children:(0,j.jsx)(d.I,{as:ae.h})}),(0,j.jsx)(l.$,{variant:"primary",m:"0",w:"30px",h:"30px",p:"0",isDisabled:x||t===(null===i||void 0===i?void 0:i.note),isLoading:x,onClick:()=>p(),children:(0,j.jsx)(d.I,{as:se.h})})]}):(0,j.jsx)(l.$,{variant:"primary",m:"0",w:"30px",h:"30px",p:"0",onClick:()=>u(!0),children:(0,j.jsx)(d.I,{as:ie.h})})})]})})]})})};var re=n(64926);const oe=()=>{var e,t,n,i,o,d;const{__:__}=(0,s.WD)(),{id:c,totalPaymentHistory:u,setTotalPaymentHistory:p}=ee(),{sort:h,onSort:b}=(0,x.y8)(),{page:g,setPage:w,onPerPageChange:y,perPage:S}=(0,x.WQ)(10),{isLoading:_,data:f}=((e,t,n,i,s)=>{const a=(0,m.gf)();return(0,v.useQuery)({queryKey:["payment-history",e,t,n,i],queryFn:async()=>{const l=await a.memberships.getPaymentHistory(e,t,n,i);return s(l.recordsTotal),l.data}})})(c,g,S,h,p),C=[{label:__("ID"),key:"id",width:"100px",rowRenderer:e=>{let{id:t}=e;return"#".concat(t)},isSortable:!0},{label:__("Subtotal"),key:"subtotal",width:"150px",condition:null!==(e=(null===(t=window.react_memberships)||void 0===t?void 0:t.taxes_info.taxes_enabled)||"1"===(null===(n=window.react_memberships)||void 0===n?void 0:n.is_coupons_enabled))&&void 0!==e&&e,rowRenderer:e=>{let{subtotal:t}=e;return(0,j.jsx)(U.x,{price:t})}},{label:__("Coupon"),key:"coupon",width:"150px",condition:"1"===(null===(i=window.react_memberships)||void 0===i?void 0:i.is_coupons_enabled),rowRenderer:e=>{let{coupon:t}=e;return null===t||void 0===t?void 0:t.formatted_value}},{label:__("Tax"),key:"taxes",width:"150px",condition:null!==(o=null===(d=window.react_memberships)||void 0===d?void 0:d.taxes_info.taxes_enabled)&&void 0!==o&&o,rowRenderer:e=>{let{taxes:t}=e;return(0,j.jsx)(U.x,{price:t})}},{label:__("Total"),key:"amount",width:"150px",rowRenderer:e=>{let{total:t}=e;return(0,j.jsx)(U.x,{price:t})}},{label:__("Payment Method"),key:"payment_method",width:"200px",rowRenderer:e=>{let{payment_method:t}=e;return(0,j.jsx)(j.Fragment,{children:(0,F.capitalize)(t)})}},{label:__("Date"),key:"date",width:"100px",rowRenderer:e=>{let{date:t}=e;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(a.E,{children:(0,k.k)(new Date(t),"UTC").date}),(0,j.jsx)(a.E,{children:(0,k.k)(new Date(t),"UTC").time})]})}},{label:__("Status"),key:"status",rowRenderer:e=>{let{status:t}=e;return(0,j.jsx)(re.StatusChip,{status:t})},isSortable:!0},{label:"",key:"",rowRenderer:e=>{let{order_id:t}=e;return(0,j.jsx)(W.s,{justify:"flex-end",children:(0,j.jsx)(l.$,{m:"0",variant:"secondary",onClick:()=>(e=>{var t;const n=null===(t=window.react_default_vars)||void 0===t?void 0:t.admin_url;n&&window.open("".concat(n,"admin.php?page=manage_orders&order_id=").concat(e),"_blank")})(t),children:__("Orders")})})}}];return(0,j.jsxs)(W.s,{flexDirection:"column",gap:"20px",mt:"20px",px:"20px",children:[(0,j.jsx)(a.E,{color:"dark",fontSize:"24px",fontWeight:"500",children:__("Payment History")}),(0,j.jsx)(r.az,{borderTop:"1px solid",borderColor:"border",children:(0,j.jsx)(x.bQ,{headers:C,data:null!==f&&void 0!==f?f:[],isLoading:_,isSelectable:!1,perPage:S,onPerPageChange:y,onPageChange:w,page:g,total:u,sort:h,onSort:b})})]})},de=e=>{var t;let{setPage:n}=e;const{__:__}=(0,s.WD)(),{data:i,isLoading:a,updateMutation:r,id:o}=ee(),{isLoading:d}=r,{mutate:u,isLoading:x}=(e=>{const t=(0,c.gf)(),n=(0,v.useQueryClient)();return(0,v.useMutation)({mutationFn:()=>t.memberships.cancelMembership(e),onSuccess:()=>{n.invalidateQueries(["membership",e])}})})(o),h=["canceled","cancelled"].includes(null!==(t=null===i||void 0===i?void 0:i.status)&&void 0!==t?t:""),b=a||d||x;return(0,j.jsxs)(f.HT,{title:(0,j.jsxs)(W.s,{flexDirection:"column",gap:"3px",children:[(0,j.jsx)(W.s,{gap:"4px",lineHeight:"normal",children:a?(0,j.jsx)(D.z,{w:"150px",h:"19px",fixedWidth:!0}):null===i||void 0===i?void 0:i.plan_name}),!i||a?(0,j.jsx)(D.z,{w:"53px",h:"18px"}):(0,j.jsx)(I,{status:null===i||void 0===i?void 0:i.status})]}),headerProps:{bg:"white",ml:"-20px",p:"20px",mt:"0",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.07)",mb:"20px"},onBack:()=>n(J.LIST),button:(0,j.jsx)(W.s,{gap:"10px",children:a?(0,j.jsx)(D.z,{w:"155px",h:"40px",fixedWidth:!0}):(0,j.jsx)(j.Fragment,{children:!h&&"expired"!==(null===i||void 0===i?void 0:i.status)&&(0,j.jsx)(l.$,{m:"0",variant:"error-tonal",isLoading:x,isDisabled:b,onClick:()=>{(0,p.SC)((()=>u()),__("Do you really want to cancel this subscription?"))()},children:__("Cancel Subscription")})})}),children:[(0,j.jsx)(le,{}),(0,j.jsx)(oe,{})]})},ce=e=>{let{setPage:t,editId:n}=e;return(0,j.jsx)(Z,{id:n,children:(0,j.jsx)(de,{setPage:t})})},ue=()=>{const{__:__}=(0,s.WD)(),[e,t]=(0,u.useState)((0,w.a)(["subscription_id"]).subscription_id?J.CREATE:J.LIST),[n,a]=(0,u.useState)((()=>{const e=(0,w.a)(["subscription_id"]);return e.subscription_id?parseInt(e.subscription_id):null})());return(0,u.useEffect)((()=>{e===J.LIST&&(a(null),(0,w.L)({subscription_id:void 0}))}),[e]),(0,p.wD)({eventFn:()=>{const e=(0,w.a)(["subscription_id"]);e.subscription_id?(t(J.CREATE),a(parseInt(e.subscription_id))):(t(J.LIST),a(null))}}),(0,j.jsxs)(i.p,{defaultValue:e,children:[(0,j.jsx)(i.a,{value:J.LIST,children:(0,j.jsx)(Y,{onRowClick:e=>{window.scroll(0,0),t(J.CREATE),a(e),(0,w.L)({subscription_id:e.toString()},!1)}})}),(0,j.jsx)(i.a,{value:J.CREATE,children:(0,j.jsx)(ce,{setPage:t,editId:n})})]})}}}]);